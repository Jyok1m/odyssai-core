# name: Deploy to Production

# on:
#   workflow_run:
#     workflows: ["Build and Deploy Docker Image"]
#     branches: [main]
#     types:
#       - completed

# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     if: ${{ github.event.workflow_run.conclusion == 'success' }}

#     steps:
#       - name: Download deployment artifacts
#         uses: actions/download-artifact@v4
#         with:
#           name: deployment-config
#           github-token: ${{ secrets.GITHUB_TOKEN }}
#           run-id: ${{ github.event.workflow_run.id }}

#       # DÃ©ploiement automatique (nÃ©cessite configuration des secrets)
#       - name: Deploy to server via SSH
#         if: ${{ secrets.DEPLOY_HOST != '' }}
#         uses: appleboy/ssh-action@v1.0.3
#         with:
#           host: ${{ secrets.DEPLOY_HOST }}
#           username: ${{ secrets.DEPLOY_USER }}
#           key: ${{ secrets.DEPLOY_KEY }}
#           script: |
#             cd /opt/odyssai
#             # Login au registry GitHub
#             echo ${{ secrets.GITHUB_TOKEN }} | docker login ghcr.io -u ${{ github.actor }} --password-stdin
#             # Pull et redÃ©ploiement
#             docker compose -f docker-compose.prod.yml pull
#             docker compose -f docker-compose.prod.yml up -d --remove-orphans
#             docker image prune -f
#             echo "âœ… DÃ©ploiement terminÃ© !"

#       # Notification si pas de serveur configurÃ©
#       - name: Manual deployment notice
#         if: ${{ secrets.DEPLOY_HOST == '' }}
#         run: |
#           echo "ðŸš€ Image buildÃ©e et disponible sur ghcr.io"
#           echo "ðŸ“‹ Pour dÃ©ployer manuellement:"
#           echo "   docker pull ghcr.io/${{ github.repository }}:latest"
#           echo "   ./deploy.sh"
